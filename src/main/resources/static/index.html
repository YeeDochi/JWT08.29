<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>JWT 인증 테스트</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .login-row-flex {
      display: flex;
      flex-direction: row;
      gap: 24px;
      align-items: stretch;
      margin-bottom: 12px;
    }
    .login-row-flex .login-flex {
      flex: 1 1 0;
      margin-bottom: 0;
    }
    .login-row-flex .result {
      flex: 1 1 0;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      min-height: 92px;
    }
    .form-row-flex {
      display: flex;
      flex-direction: row;
      gap: 24px;
      align-items: stretch;
      margin-bottom: 12px;
    }
    .form-row-flex .form-flex {
      flex: 1 1 0;
      margin-bottom: 0;
    }
    .form-row-flex .result {
      flex: 1 1 0;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      min-height: 92px;
    }
    .login-flex {
      width: 60%;
      display: flex;
      gap: 13px;
      align-items: center;
      margin-bottom: 12px;
    }
    .login-inputs {
      display: flex;
      flex-direction: column;
      gap: 11px;
      flex: 1 1 0;
    }
    .login-inputs input {
      width: 100%;
      height: 30px;
      box-sizing: border-box;
    }
    .login-btn {
      height: 92px;
      min-width: 120px;
      font-size: 17px;
      padding: 0 24px;
    }
    .form-flex {
      width: 60%;
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 12px;
    }
    .form-inputs {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1 1 0;
    }
    .form-inputs input {
      width: 100%;
      box-sizing: border-box;
      height: 30px;
      font-size: 16px;
    }
    .form-btn {
      height: 92px;
      min-width: 120px;
      font-size: 17px;
      padding: 0 24px;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background: #f6f8fa;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 32px 24px;
    }
    h2 { margin-top: 0; }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 8px 12px;
      margin: 8px 0 16px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
    }
    button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 18px;
      font-size: 15px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #1565c0; }
    .result {
      font-size: 14px;
      color: #333;
      background: #f1f3f6;
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 16px;
      min-height: 20px;
    }
    hr { margin: 24px 0; }
    .token-box {
      background: #e3f2fd;
      border-radius: 6px;
      padding: 8px;
      font-size: 13px;
      word-break: break-all;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>멤버 가입</h2>
    <div class="form-row-flex">
      <div id="memberRegisterResult" class="result"></div>
      <div class="form-flex">
        <div class="form-inputs">
          <input id="member-username" placeholder="아이디">
          <input id="member-password" type="password" placeholder="비밀번호">
        </div>
        <button class="form-btn" onclick="registerMember()">멤버 가입</button>
      </div>
    </div>
    <h2>어드민 가입</h2>
    <div class="form-row-flex">
      <div id="adminRegisterResult" class="result"></div>
      <div class="form-flex">
        <div class="form-inputs">
          <input id="admin-username" placeholder="아이디">
          <input id="admin-password" type="password" placeholder="비밀번호">
        </div>
        <button class="form-btn" onclick="registerAdmin()">어드민 가입</button>
      </div>
    </div>
    <hr>
    <h2>로그인</h2>
    <div class="login-row-flex">
      <div id="loginResult" class="result"></div>
      <div class="login-flex">
        <div class="login-inputs">
          <input id="username" placeholder="아이디">
          <input id="password" type="password" placeholder="비밀번호">
        </div>
        <button class="login-btn" onclick="login()">로그인</button>
      </div>
    </div>
    <hr>
    <h2>엑세스 토큰</h2>
    <div class="token-box">AccessToken: <span id="accessToken"></span></div>
    <hr>
    <button onclick="whoami()">내 정보(whoami)</button>
    <div id="whoamiResult" class="result"></div>
    <button onclick="refreshTokenFunc()">리프레시</button>
    <div id="refreshResult" class="result"></div>
    <button onclick="logout()">로그아웃</button>
    <div id="logoutResult" class="result"></div>
  </div>
  <script>
    let accessToken = "";

    function registerMember() {
      document.getElementById('memberRegisterResult').innerText = '';
      fetch('http://localhost:8081/api/member/join', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('member-username').value,
          password: document.getElementById('member-password').value
        })
      })
      .then(async res => {
        let text = await res.text();
        try {
          let json = JSON.parse(text);
          if (json.status && json.error) {
            document.getElementById('memberRegisterResult').innerText = `[${json.status}] ${json.error}`;
          } else {
            document.getElementById('memberRegisterResult').innerText = JSON.stringify(json, null, 2);
          }
        } catch {
          document.getElementById('memberRegisterResult').innerText = text;
        }
      })
      .catch(err => document.getElementById('memberRegisterResult').innerText = '에러: ' + err);
    }

    function registerAdmin() {
      document.getElementById('adminRegisterResult').innerText = '';
      fetch('http://localhost:8081/api/admin/join', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('admin-username').value,
          password: document.getElementById('admin-password').value
        })
      })
      .then(async res => {
        let text = await res.text();
        try {
          let json = JSON.parse(text);
          if (json.status && json.error) {
            document.getElementById('adminRegisterResult').innerText = `[${json.status}] ${json.error}`;
          } else {
            document.getElementById('adminRegisterResult').innerText = JSON.stringify(json, null, 2);
          }
        } catch {
          document.getElementById('adminRegisterResult').innerText = text;
        }
      })
      .catch(err => document.getElementById('adminRegisterResult').innerText = '에러: ' + err);
    }

    function login() {
      document.getElementById('loginResult').innerText = '';
      fetch('http://localhost:8081/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('username').value,
          password: document.getElementById('password').value
        })
      })
      .then(async res => {
        let body = await res.text();
        accessToken = res.headers.get('Authorization')?.replace('Bearer ', '') || body.replace('Bearer ', '') || "";
        try {
          let json = JSON.parse(body);
          if (json.status && json.error) {
            document.getElementById('loginResult').innerText = `[${json.status}] ${json.error}`;
          } else {
            document.getElementById('loginResult').innerText = accessToken ? '로그인 완료' : JSON.stringify(json, null, 2);
          }
        } catch {
          document.getElementById('loginResult').innerText = accessToken ? '로그인 완료' : body;
        }
        document.getElementById('accessToken').innerText = accessToken || '(헤더로 전달됨)';
      })
      .catch(err => document.getElementById('loginResult').innerText = '에러: ' + err);
    }

    function whoami() {
      document.getElementById('whoamiResult').innerText = '';
      if (!accessToken) {
        document.getElementById('whoamiResult').innerText = '엑세스 토큰이 없습니다. 로그인 후 이용하세요.';
        return;
      }
      fetch('http://localhost:8081/api/me', {
        method: 'GET',
        headers: { 'Authorization': 'Bearer ' + accessToken }
      })
      .then(async res => {
        let text = await res.text();
        try {
          let json = JSON.parse(text);
          if (json.status && json.error) {
            document.getElementById('whoamiResult').innerText = `[${json.status}] ${json.error}`;
          } else {
            document.getElementById('whoamiResult').innerText = JSON.stringify(json, null, 2);
          }
        } catch {
          document.getElementById('whoamiResult').innerText = text;
        }
      })
      .catch(err => document.getElementById('whoamiResult').innerText = '에러: ' + err);
    }

    function refreshTokenFunc() {
      document.getElementById('refreshResult').innerText = '';
      if (!accessToken) {
        document.getElementById('refreshResult').innerText = '엑세스 토큰이 없습니다. 로그인 후 이용하세요.';
        return;
      }
     
      fetch('http://localhost:8081/api/reissue', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
        // 쿠키는 브라우저가 자동으로 포함시킴
      })
      .then(async res => {
        let body = await res.text();
        accessToken = res.headers.get('Authorization')?.replace('Bearer ', '') || body.replace('Bearer ', '') || accessToken;
        try {
          let json = JSON.parse(body);
          if (json.status && json.error) {
            document.getElementById('refreshResult').innerText = `[${json.status}] ${json.error}`;
          } else {
            document.getElementById('refreshResult').innerText = accessToken ? '리프레시 완료' : JSON.stringify(json, null, 2);
          }
        } catch {
          document.getElementById('refreshResult').innerText = accessToken ? '리프레시 완료' : body;
        }
        document.getElementById('accessToken').innerText = accessToken;
      })
      .catch(err => document.getElementById('refreshResult').innerText = '에러: ' + err);
    }

    function logout() {
      document.getElementById('logoutResult').innerText = '';
      if (!accessToken) {
        document.getElementById('logoutResult').innerText = '엑세스 토큰이 없습니다. 로그인 후 이용하세요.';
        return;
      }
     
      fetch('http://localhost:8081/logout', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' +accessToken }
      })
      .then(async res => {
        let text = await res.text();
        try {
          let json = JSON.parse(text);
          if (json.status && json.error) {
            document.getElementById('logoutResult').innerText = `[${json.status}] ${json.error}`;
          } else {
            document.getElementById('logoutResult').innerText = JSON.stringify(json, null, 2);
          }
        } catch {
          document.getElementById('logoutResult').innerText = text;
        }
        accessToken = "";
        document.getElementById('accessToken').innerText = "";
      })
      .catch(err => document.getElementById('logoutResult').innerText = '에러: ' + err);
    }
  </script>
</body>
</html>
